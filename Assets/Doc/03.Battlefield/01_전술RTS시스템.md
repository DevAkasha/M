# 전술 RTS 시스템

## 개요
전장은 실시간 전술 시뮬레이션(RTS) 방식으로 진행됩니다. 플레이어는 부대를 지휘하여 승리를 목표로 합니다.

---

## 전장 구성

### 맵 구조
```
┌────────────────────────────────────┐
│         적 진영 (상단)              │
│  [적군][적군][적군][적군][적군]     │
│                                    │
│ [숲]  [전장 중앙 지역]      [숲]   │
│                                    │
│  [아군][아군][아군][아군][아군]     │
│        플레이어 진영 (하단)         │
└────────────────────────────────────┘
```

### 지형 요소
| 지형 | 위치 | 효과 | 활용 병종 |
|------|------|------|----------|
| 숲 | 좌우 끝 | 은신, 매복 가능 | 레인저, 기병 |
| 고지대 | 맵에 따라 배치 | 원거리 공격력/방어력 +30% | 석궁수, 레인저 |
| 강/늪 | 맵에 따라 배치 | 이동속도 -50%, 기병 효율 -70% | - |
| 요새 | 맵에 따라 배치 | 방어력 +50%, 회복력 +20% | 전사, 석궁수 |
| 마나천 | 맵에 따라 배치 | 마나회복 +50%, 마법공격력 +20% | 마법사 |

---

## 부대 시스템

### 부대 편성
```
부대 구성:
- 병사: 20~50명/부대
- 부대장: 1명/부대
- 최대 부대 수: 8개
```

### 부대 크기별 특성
| 부대 규모 | 병사 수 | 기동성 | 화력 | 유지력 |
|----------|---------|--------|------|--------|
| 소규모 | 20명 | 높음 | 낮음 | 낮음 |
| 중규모 | 35명 | 중간 | 중간 | 중간 |
| 대규모 | 50명 | 낮음 | 높음 | 높음 |

### 부대 대형
| 대형 | 효과 | 적합 상황 |
|------|------|----------|
| 밀집 대형 | 방어력 +20%, 이동속도 -10% | 방어, 거점 사수 |
| 산개 대형 | 광역 피해 -30%, 공격력 -10% | 대 마법사 전투 |
| 돌격 대형 | 공격력 +30%, 방어력 -20% | 공격, 돌파 |
| 방어 대형 | 방어력 +40%, 공격력 -30% | 후퇴, 시간 벌기 |

---

## 조작 시스템

### 부대 선택
```
방법 1: 부대 아이콘 클릭
방법 2: 부대 직접 터치/클릭
방법 3: 숫자 단축키 (1~8)
```

### 4×2 영역 드래그 시스템
```
부대 선택 후, 8방향 드래그:

    [1스킬]    [상-돌격]    [2스킬]

    [좌-사수]     중심     [우-유지]

    [4스킬]    [하-후퇴]    [3스킬]
```

#### 이동 명령
| 방향 | 명령 | 효과 |
|------|------|------|
| 상 (↑) | 돌격 | 최대 속도로 전진, 공격력 +20% |
| 하 (↓) | 후퇴 | 후방으로 이동, 방어 대형 |
| 좌 (←) | 지역 사수 | 현 위치 고수, 방어력 +30% |
| 우 (→) | 군세 유지 | 유리 시 천천히 전진, 불리 시 천천히 후퇴 |

#### 스킬 명령
| 방향 | 스킬 슬롯 | 설명 |
|------|----------|------|
| 좌상 (↖) | 1번 스킬 | 주력 공격 스킬 |
| 우상 (↗) | 2번 스킬 | 버프/유틸 스킬 |
| 우하 (↘) | 3번 스킬 | 광역 공격 스킬 |
| 좌하 (↙) | 4번 스킬 | 궁극기 |

### 대체 조작 방식 (옵션)
```
클래식 RTS 모드:
- 부대 클릭 선택
- 목표 지점 클릭 → 이동
- 스킬 버튼 UI 클릭 → 스킬 사용
```

---

## 전술 영역 시스템

### 플레이어 전술 영역
```
반경 = 통찰 스탯 × 10m

예시:
통찰 10 → 반경 100m
통찰 50 → 반경 500m
```

### 영역 내 효과
| 효과 | 수치 | 설명 |
|------|------|------|
| 능력치 버프 | +(통찰계수)% | 모든 스탯 증가 |
| 부대장 스킬 사용 권한 | - | 영역 밖에서는 스킬 사용 불가 |
| 사기 | +50% | 사기 관련 페널티 감소 |
| 시야 공유 | - | 영역 내 모든 부대의 시야 공유 |

### 통찰 계수 계산
```
통찰계수 = (통찰 × 2) + (힘 + 정신 + 신성) × 0.3

예시:
통찰 20, 힘 10, 정신 15, 신성 5
→ (20 × 2) + (10 + 15 + 5) × 0.3 = 40 + 9 = 49%
```

### 플레이어 이동
```
조작:
- 플레이어 아이콘 드래그 → 원하는 위치로 이동

이동 속도:
- 기본: 부대와 동일
- 말 탑승 (연구 필요): 부대의 150%

전술 영역 운용:
- 주력 부대 근처에 위치
- 위험 시 후방으로 후퇴
- 다수 전선 지원 시 중앙 배치
```

---

## 전투 메커니즘

### 전투 거리
```
근접 전투:
- 사거리: 5m
- 대상: 인접한 적

원거리 전투:
- 사거리: 50~100m (병종마다 다름)
- 대상: 사거리 내 모든 적 (우선순위 적용)

마법 전투:
- 사거리: 80~150m
- 대상: 지정 영역 또는 단일 적
```

### 타겟팅 우선순위
```
자동 타겟:
1. 교전 중인 적
2. 가장 가까운 적
3. HP가 낮은 적 (30% 이하)
4. 위협도가 높은 적 (마법사, 엘리트)

수동 타겟 (부대장 스킬):
- 플레이어가 직접 선택
```

### 전투 해상도
```
1초마다 전투 계산:
1. 사거리 내 적 확인
2. 명중률 판정
3. 크리티컬 판정
4. 데미지 계산
5. 방어력 적용
6. 피해 적용
```

---

## 병종 상성 시스템

### 상성 테이블
```
전사(밀집):
  강함: 석궁수(밀집), 전투마법사
  약함: 전술마법사, 레인저

기병:
  강함: 레인저, 전술마법사
  약함: 전투마법사, 석궁수

레인저:
  강함: 전술마법사, 전사
  약함: 기병, 전투마법사

석궁수(밀집):
  강함: 전투마법사, 기병
  약함: 전사, 전술마법사

전술마법사(밀집):
  강함: 전사, 석궁수
  약함: 레인저, 기병

전투마법사:
  강함: 기병, 레인저
  약함: 석궁수, 전사

성직자:
  역할: 치료 (전투 상성 없음)
  약함: 모든 전투 병종
```

### 상성 데미지 보정
```
유리한 상성: 데미지 +50%
불리한 상성: 데미지 -30%
중립 상성: 보정 없음
```

---

## 사기 시스템

### 사기 수치
```
범위: 0 ~ 200
기본: 100

높은 사기 (150+):
- 공격력 +20%
- 방어력 +20%
- 이동속도 +10%

낮은 사기 (50-):
- 공격력 -30%
- 방어력 -30%
- 도주 위험

사기 붕괴 (0):
- 부대 도주 (전투 이탈)
```

### 사기 증감 요인
| 요인 | 변화량 | 설명 |
|------|--------|------|
| 전투 승리 | +20 | 적 부대 격파 |
| 전투 패배 | -30 | 아군 부대 전멸 |
| 손실 (50% 이상) | -40 | 부대 병력 절반 상실 |
| 부대장 전사 | -50 | 지휘관 상실 |
| 플레이어 전술 영역 | +50% | 영역 내 사기 유지 |
| 승리 기대감 | +10 | 아군 우세 |
| 패배 공포 | -20 | 적군 우세 |
| 고립 | -30 | 인근 아군 부대 없음 |

---

## 부대 손실과 재편

### 병력 손실
```
전투 중 사망:
- 개별 병사가 사망 처리
- 부대 병력 수 감소
- 일정 수 이하 시 전투력 급감

최소 유지 병력:
- 5명 이하: 전투 불가, 자동 후퇴
- 0명: 부대 전멸 (부대장만 생존 가능)
```

### 부대 재편
```
전투 중:
- 불가능

전투 후:
- 생존 병사로 부대 재편성
- 부대 통합 (2개 이상의 소규모 부대 → 1개 부대)
- 보급 (본거지에서 병력 보충)
```

---

## 승리 조건

### 일반 전장
```
승리:
- 모든 적 격파
- 적 지휘관 처치 (특정 시나리오)
- 거점 점령 (특정 시나리오)

패배:
- 모든 아군 부대 전멸
- 플레이어 전사 (특정 시나리오)
- 시간 초과 (특정 시나리오)

무승부:
- 양측 동시 전멸 (드물음)
```

### 마계 전장
```
종료 조건:
- 아군 전멸만 가능
- 포기 선택 시 즉시 종료 (병력 전부 손실)

웨이브 진행:
- 끝없이 적 출현
- 5웨이브마다 난이도 증가
- 보상 누적
```

---

## 전투 AI

### 부대 AI (명령 없을 때)
```
기본 행동:
- 가장 가까운 적과 교전
- 불리 시 후퇴
- 고립 시 인근 아군 합류

특수 행동:
- 원거리 유닛: 사거리 유지
- 마법사: MP 관리 (일반 공격 → 스킬 교체)
- 성직자: 아군 치료 우선
```

### 적 AI
```
난이도별:
- 하급: 단순 전진
- 중급: 병종 상성 고려
- 상급: 전술적 우회, 집중 공격
- 악몽: 플레이어 수준의 전술

특수 AI:
- 암살 부대: 후방 급습
- 돌격 부대: 빠른 전진
- 방어 부대: 거점 고수
```

---

## 전투 UI

### 메인 화면
```
상단:
- 시간 / 웨이브 정보
- 아군/적군 병력 수
- 목표 정보

하단:
- 부대 아이콘 (1~8)
- 각 부대 HP 바
- 스킬 쿨타임 표시

좌측:
- 플레이어 HP/MP
- 전술 영역 범위 표시

우측:
- 미니맵
- 전장 전체 상황
```

### 부대 정보
```
부대 선택 시:
- 부대명 / 병종
- 병력 수 (현재 / 최대)
- 부대장 정보
- 스킬 4개 (쿨타임)
- 사기 수치
- 버프/디버프 아이콘
```

---

## 전투 속도 조절

### 배속 옵션
```
1배속: 기본
2배속: 빠른 진행 (권장)
3배속: 매우 빠른 진행
일시정지: 명령 입력 가능 (고급 모드)
```

### 일시정지 모드 (옵션)
```
해금: 연구 필요
기능:
- 전투 일시정지
- 명령 예약
- 재생 시 한 번에 실행

제한:
- 사용 횟수 제한 (난이도별)
- 경험치/보상 -20%
```
