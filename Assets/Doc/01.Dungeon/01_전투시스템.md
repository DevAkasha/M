# 던전 전투 시스템

## 개요
던전은 방치형 RPG 스타일의 전투 시스템입니다. 기본적으로 자동 진행되며, 플레이어는 스킬 타이밍을 선택할 수 있습니다.

---

## 전투 방식

### 자동 전투 시스템
- **기본 공격**: 자동으로 진행
- **스킬 사용**: 플레이어가 선택 가능
- **타겟팅**: 자동 (최전방 적 우선)

### 전투 흐름
```
던전 입장
↓
웨이브 시작
↓
자동 전투 진행 (기본 공격)
↓
스킬 쿨타임 충족 시 플레이어 선택
↓
웨이브 클리어
↓
다음 웨이브 or 던전 클리어
```

---

## 전투 수치 계산

### 데미지 계산식
```
기본 데미지 = 공격력 - (방어력 × 0.5)
최종 데미지 = 기본 데미지 × (1 + 크리티컬) × (1 + 속성보너스) × 포지션보너스
```

### 명중률 계산
```
명중률 = 85% + (적중력 - 회피력) × 0.1%
최소 명중률 = 50%
최대 명중률 = 95%
```

### 크리티컬 계산
```
크리티컬 확률 = 기본 5% + 행운 × 0.2%
크리티컬 데미지 = 150% (기본)
```

---

## 공격 타입별 특성

### 근접 공격 (Melee)
- **스탯 의존**: 힘
- **적용 방어**: 근접 방어력
- **사거리**: 전방 1칸
- **특징**: 높은 안정성, 낮은 리스크

### 원거리 공격 (Ranged)
- **스탯 의존**: 제어
- **적용 방어**: 원거리 방어력
- **사거리**: 전방 3칸
- **특징**: 후방 배치 가능, 중간 화력

### 마법 공격 (Magic)
- **스탯 의존**: 지능
- **적용 방어**: 마법 방어력
- **사거리**: 전방 3칸
- **특징**: 높은 화력, 마나 소모

### 신성 공격 (Divine)
- **스탯 의존**: 신성
- **적용 방어**: 신성 방어력
- **사거리**: 전방 3칸
- **특징**: 언데드 특효, 마나 소모

---

## 상태 이상

### 군중 제어 (CC)
| 상태 | 효과 | 지속시간 | 저항 |
|------|------|----------|------|
| 기절 (Stun) | 행동 불가 | 2초 | 정신 |
| 빙결 (Freeze) | 행동 불가, 방어력 -30% | 3초 | 신성 방어력 |
| 속박 (Root) | 이동 불가 | 4초 | 민첩 |
| 침묵 (Silence) | 스킬 사용 불가 | 5초 | 지능 |

### 지속 피해 (DoT)
| 상태 | 효과 | 지속시간 | 틱 주기 |
|------|------|----------|---------|
| 출혈 (Bleed) | 최대 HP의 2%/틱 | 10초 | 2초 |
| 화상 (Burn) | 공격력의 50%/틱 | 8초 | 2초 |
| 중독 (Poison) | 고정 피해 100/틱 | 12초 | 3초 |

### 디버프
| 상태 | 효과 | 지속시간 |
|------|------|----------|
| 약화 (Weaken) | 공격력 -30% | 10초 |
| 취약 (Vulnerable) | 받는 피해 +50% | 8초 |
| 둔화 (Slow) | 공격 속도 -40% | 6초 |
| 실명 (Blind) | 적중률 -50% | 5초 |

---

## 전투 AI

### 플레이어 파티 AI
1. **타겟 우선순위**:
   - 최전방 적
   - HP가 낮은 적 (30% 이하)
   - 위험도가 높은 적 (보스, 엘리트)

2. **스킬 사용 우선순위** (자동 모드):
   - 생존 스킬 (HP 50% 이하)
   - 군중 제어 스킬 (보스전)
   - 딜링 스킬 (기본)

### 적 AI
1. **타겟 우선순위**:
   - 최전방 아군
   - HP가 낮은 아군
   - 힐러 우선 (엘리트 이상)

2. **스킬 사용**:
   - 랜덤 타이밍
   - HP 임계값 (50%, 30%, 10%)
   - 패턴 기반 (보스)

---

## 전투 종료 조건

### 승리 조건
- 웨이브의 모든 적 처치

### 패배 조건
- 파티원 전멸

### 중단 조건
- 플레이어가 수동으로 던전 나가기
- 파티원 HP 50% 이하 시 자동 철수 (옵션)

---

## 전투 속도

### 속도 옵션
| 배속 | 설명 | 잠금 조건 |
|------|------|----------|
| 1배속 | 기본 속도 | 없음 |
| 2배속 | 빠른 진행 | 던전 1회 클리어 |
| 3배속 | 매우 빠른 진행 | 던전 3회 클리어 |
| 자동 | 완전 자동 (스킬 포함) | 던전 5회 클리어 |

---

## 전투 통계

### 실시간 표시 정보
- 파티원별 HP/MP 바
- 현재 웨이브 / 전체 웨이브
- 경과 시간
- 획득 경험치 (누적)

### 전투 종료 후 통계
- 총 데미지량 (파티원별)
- 받은 데미지량
- 회복량 (힐러)
- 스킬 사용 횟수
- 평균 DPS
- 클리어 시간
